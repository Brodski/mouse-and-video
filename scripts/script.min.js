let isDebugging=!1;0==isDebugging&&(console.log=function(...a){});console.log("++++--- EXTENSION LOADED 123  ----++++ ");const minVideoWidth=415;
(function(){console.log("GO!");document.querySelector("video")?chrome.runtime.sendMessage({showIcon:!0}):(new MutationObserver(function(a,b){document.querySelector("video")&&(chrome.runtime.sendMessage({showIcon:!0}),console.log("MUTATION ----------- Found video, sending "),console.log(a),console.log(b),b.disconnect())})).observe(document,{attributes:!0,childList:!0,subtree:!0})})();let isNetflix=!1;document.addEventListener("mvNetflix",function(a){isNetflix=!0});
if(location.href.includes("netflix.com")){const a=document.createElement("script");a.textContent="if (netflix){\n    document.dispatchEvent(new CustomEvent('mvNetflix', { isNetflix: true }));\n    document.addEventListener('mvNetflixSeek', function (e) {\n      const player = netflix.appContext.state.playerApp.getAPI().videoPlayer.\n      getVideoPlayerBySessionId(netflix.appContext.state.playerApp.getAPI().\n      videoPlayer.getAllPlayerSessionIds()[0])\n      player.seek(e.detail)\n    })\n  }";
(document.head||document.documentElement).appendChild(a);a.remove()}
window.addEventListener("message",a=>{console.log("recieved some message e.data",a);a.data.mv_topIframe&&window.top.postMessage({mv_iframeSrc:window.location.href},"*");window.location===window.parent.location&&(a.data.mv_iframeSrc?(console.log("gonna pop up!"),document.mv_popup_element=document.querySelector(`iframe[src="${a.data.mv_iframeSrc}"`),document.documentElement.style.overflow="hidden","fullscreen"!=mvObject.popoutSetting&&(document.mv_popup_element.classList.add("popup_style"),chrome.runtime.sendMessage({popup:!0,
acao:"criar"})),"fullscreen"==mvObject.popoutSetting&&(console.log("adding fullscreen"),document.mv_popup_element.classList.add("fullscreenIframe_style"))):a.data.mv_closePopup&&(document.mv_popup_element.classList.remove("popup_style"),document.mv_popup_element.classList.remove("fullscreenIframe_style"),document.documentElement.style.overflow="revert","fullscreen"!=mvObject.popoutSetting&&chrome.runtime.sendMessage({popup:!0,acao:"fechar",activatePopupTab:a.data.activatePopupTab})))});
chrome.runtime.onMessage.addListener(function(a){console.log("Content Script - MSG FROM BACKGROUND -",a);a.run?run():a.disabled&&(document.onwheel=null,document.pvwm.onwheel=null,document.pvwm.mv_on=!1)});let mvObject={};
chrome.storage.local.get(function(a){console.log("Scripts - options",a);mvObject={left:a.left||5,middle:a.middle||10,right:a.right||15,mode:a.mode||"mode_everything",volumeRate:a.volumeRate||6,mute_middle_mouse:a.mute_middle_mouse||!0,brightness:1,volume:0,popoutSetting:a.popoutSetting||"disable",popup:(b,d)=>{chrome.runtime.sendMessage({popup:!0,acao:b,activatePopupTab:d})}}});function getTopIframe(a){return a.parent!==window.top?getTopIframe(a.parent):a}
chrome.storage.onChanged.addListener(function(a){console.log("Updating script values...");console.log("changes",a);mvObject[Object.keys(a)[0]]=a[Object.keys(a)[0]].newValue});function convertImages(a,b){for(const d in a){let c=a[d];fetch(c.src).then(e=>e.text()).then(e=>{e=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg");c.id&&(e.id=c.id);c.className&&(e.classList=c.classList);a[d]=e}).then(b).catch(e=>console.error(e))}}let iconsDict={};
function setupIcons(){let a=document.createElement("div");a.id="mouse-vid-icon-wrapper";let b=document.createElement("img"),d=document.createElement("img"),c=document.createElement("img"),e=document.createElement("img"),f=document.createElement("img"),g=document.createElement("img"),h=document.createElement("img");b.src=browser.runtime.getURL("../icons/seek_ff.svg");d.src=browser.runtime.getURL("../icons/seek_rewind.svg");c.src=browser.runtime.getURL("../icons/vol_decrease.svg");e.src=browser.runtime.getURL("../icons/vol_increase.svg");
f.src=browser.runtime.getURL("../icons/vol_mute.svg");g.src=browser.runtime.getURL("../icons/vol_sound.svg");h.src=browser.runtime.getURL("../icons/play_speed.svg");b.id="seek_ff";d.id="seek_rewind";c.id="vol_decrease";e.id="vol_increase";f.id="vol_mute";g.id="vol_sound";h.id="play_speed";iconsDict.seek_ff=b;iconsDict.seek_rewind=d;iconsDict.vol_decrease=c;iconsDict.vol_increase=e;iconsDict.vol_mute=f;iconsDict.vol_sound=g;iconsDict.play_speed=h;document.body.append(a);convertImages(iconsDict,()=>
{})}
function setupStyles(){let a=document.createElement("style");document.body.append(a);a.innerHTML="\n    .volume-icon {\n      position: absolute;\n      display: inline-flex;\n    }\n    #mouse-vid-icon-wrapper {\n      position: absolute;\n      z-index: 999;\n    }\n\n    #mouse-vid-icon-wrapper svg,\n    #mouse-vid-icon-wrapper img,\n    #mouse-vid-icon-wrapper span {\n      position: absolute;\n      height: 14px;\n      width: 14px;\n      height: 16px;\n      width: 16px;\n      pointer-events: none; \n      opacity: 0;\n      filter: drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));\n    }    \n    #mouse-vid-icon-wrapper span {\n      color: white;\n      left: calc(18px + 6px);\n      font-size: 14px;\n      white-space: nowrap;\n    }\n    #mouse-vid-icon-wrapper svg path {\n      fill: white;\n    }    \n    .fade-icon-out, \n    .fade-icon-out svg, \n    .fade-icon-out span {\n      animation: fadeOut ease 1.75s;\n    }\n    @keyframes fadeOut {\n      0% {\n        opacity: .9;\n      }\n      100% {\n        opacity:0;\n      }\n    }\n    #mouse-vid-icon-wrapper .disp-block {\n      display: block;\n    }\n    .stop-scrolling {\n      height: 100%;\n      overflow: hidden;\n    }\n  "}
function getAllWrapingEles(a,b){if(a.clientWidth<minVideoWidth)return!1;let d=[b],c=b;for(;c.previousElementSibling;)d.push(c.previousElementSibling),c=c.previousElementSibling;for(c=b;c.nextElementSibling;)d.push(c.nextElementSibling),c=c.nextElementSibling;for(let e of d)a.getBoundingClientRect().width==e.getBoundingClientRect().width&&a.getBoundingClientRect().height==e.getBoundingClientRect().height&&a.offsetLeft==e.offsetLeft&&a.offsetHeight==e.offsetHeight?(console.log(" \u2714\u2714\u2714\u2714\u2714 Adding candidate"),
e.videoReference=a):console.log(" X X X X NOT adding candidate")}function getAllWrapingElesAux(){let a=0;for(const b of document.querySelectorAll("video"))getAllWrapingEles(b,b.parentElement),a++}
function setUpElementWithVideo(a,b){a.preventDefault();console.log("Setting up Element with video ....... start 1 ");document.mv_popup_element=b;b.hasPlaceholder||(b.hasPlaceholder=!0,document.mv_placeholder=document.createElement("div"),document.mv_popup_element.parentNode.insertBefore(document.mv_placeholder,document.mv_popup_element));a.target.mv_on=!0;a.target.onwheel=d=>wheel(d,b);document.pvwm=a.target;console.log("Setting up Element with video ....... complete 2");wheel(a,b)}
function getVidIfPresent(a){console.log("SHORTCUT FINDER!");if(!document.mv_pause_function&&!a.target.isNotAVideoWrapper){if("VIDEO"==a.target.tagName)return console.log("SHORTCUT FINDER - vidElement"),{type:"videoElement"};if(a.target.videoReference)return console.log("SHORTCUT FINDER - videoReference"),{type:"videoReference"};for(const b of document.querySelectorAll("video"))if(b.clientWidth<minVideoWidth)console.log(".....video too small");else if(a.clientY>=b.getBoundingClientRect().y&&a.clientY<=
b.getBoundingClientRect().y+b.clientHeight&&a.clientX>=b.getBoundingClientRect().x&&a.clientX<=b.getBoundingClientRect().x+b.clientWidth)return console.log("SHORTCUT FINDER - longsearch"),{type:"longSearch",vid:b};a.target.isNotAVideoWrapper=!0;console.log("SHORTCUT FINDER - nothing")}}
function run(){function a(b){console.log("is middle mouse",1==b.button);if(!(b.target.mute_on||1!=b.button||b.target.clientWidth<minVideoWidth)){var d=getVidIfPresent(b),c=null;null==d?console.log("Script - MUTE NULL - nothing "):("videoElement"==d.type&&(console.log("Script - MUTE NULL - videoElement "),c=b.target),"videoReference"==d.type&&(console.log("Script - MUTE NULL - videoReference "),c=b.target.videoReference),"longSearch"==d.type&&(console.log("Script - MUTE NULL - longSearch "),c=d.vid),
null!=c&&(console.log("Script - MUTE DOING SOMETHING - GOGOG "),b.preventDefault(),b.target.mute_on=!0,b.target.addEventListener("mousedown",e=>{doMute(e,c)}),doMute(b,c)))}}console.log("!!!!!! IN RUN !!!!!!");getAllWrapingElesAux();setupStyles();setupIcons();window.addEventListener("wheel",function(b){console.log("-------\x3e MAIN! aka document.WHEEL!< -----------");if(b.target.clientWidth<minVideoWidth||1==b.target.mv_on)return!1;const d=()=>{let f=document.body.style.padding,g="calc("+document.body.style.padding+
" "+(window.innerWidth-document.documentElement.clientWidth)+"px)";document.body.classList.add("stop-scrolling");document.body.style.paddingRight=g;setTimeout(()=>{document.body.classList.remove("stop-scrolling");document.body.style.paddingRight=f},500)};let c=getVidIfPresent(b),e=null;null==c?console.log("Script - VIDEO NULL - nothing "):("videoElement"==c.type&&(e=b.target,console.log("Script - VIDEO - Found video refrence - fast 1")),"videoReference"==c.type&&(e=b.target.videoReference,console.log("Script - VIDEOREFERENCE - Found video refrence - fast 2")),
"longSearch"==c.type&&(e=c.vid,console.log("Script - Found for video refrence - slow 2")),null!=e&&(d(),setUpElementWithVideo(b,e)))});window.addEventListener("mousedown",a);(function(){console.log("aux middle mouse");document.querySelectorAll("video").forEach(b=>{console.log("found video",b);console.log("found video parent",b.parentElement);let d=document.createElement("div");(function(c,e){console.log("wrap=========================");c.parentNode.insertBefore(e,c);e.appendChild(c)})(b,d);d.addEventListener("mousedown",
c=>{a(c);!0})})})()}
function wheel(a,b){if(document.mv_pause_function)console.log("WHEELPAUSE FUNCTION");else{console.log("WHEEL EVENT");a.preventDefault();a.stopPropagation();var d=a.clientX-Math.round(b.getBoundingClientRect().x),c=a.deltaY;a.shiftKey?setBrightness(c,b):(console.log("MODE: ",mvObject.mode),"mode_seek_middle"===mvObject.mode?(console.log("-------\x3e SKIP 1"),b.currentTime+=getIncrement(c,mvObject.middle)):"mode_seek_only"===mvObject.mode?(console.log("-------\x3e SKIP 2"),seekVideoByAreas(d,c,b)):
"mode_volume"===mvObject.mode?(console.log("-------\x3e VOLUME"),changeVolume(c,b)):a.offsetY<=b.clientHeight/2?d<b.clientWidth-.9*b.clientWidth?(console.log("-------\x3e POP-UP/FULLSCREEN"),controlPopoutEvent({delta:c,vid:b,e:a})):d>b.clientWidth-.1*b.clientWidth?(console.log("-------\x3e SPEED"),changePlaybackRate(c,b)):(console.log("-------\x3e VOLUME 2"),changeVolume(c,b)):(console.log("-------\x3e SKIP 3"),seekVideoByAreas(d,c,b)))}}
function displayIcon(a,b,d){var c=document.createElement("span");c.innerText=b;b=document.getElementById("mouse-vid-icon-wrapper");b.innerHTML=iconsDict[a].outerHTML+c.outerHTML;b.classList.remove("fade-icon-out");b.classList.add("fade-icon-out");c=window.pageXOffset||d.scrollLeft;a=window.pageYOffset||d.scrollTop;a=d.getClientRects()[0].top+a;c=d.getClientRects()[0].left+c;d=d.getClientRects()[0].width/2;b.style.top=a+"px";b.style.left=c+d-32+"px";document.body.appendChild(b)}
function doMute(a,b){1==a.button&&(a.preventDefault(),b.muted=!b.muted,1==b.muted?displayIcon("vol_mute","",b):displayIcon("vol_sound","",b))}
function changeVolume(a,b){console.log("Script - VOLUME - volume change");b.muted&&(b.muted=!1);if(0>a){var d=b.volume+.01*mvObject.volumeRate;d=1<=d?"1.00":d.toFixed(2);displayIcon("vol_increase",d,b)}else d=b.volume-.01*mvObject.volumeRate,d=0>=d?"0.00":d.toFixed(2),displayIcon("vol_decrease",d,b);mvObject.volume=b.volume;d=0>a?.01*mvObject.volumeRate:-.01*mvObject.volumeRate;console.log("deltaVolume",d);console.log(" mvObject.volume",mvObject.volume);0>a&&1<=d+mvObject.volume?(console.log(" SHAZAM 1"),
mvObject.volume=1):0<a&&0>=d+mvObject.volume?(console.log(" SHAZAM 2"),mvObject.volume=0):(console.log(" SHAZAM 3"),mvObject.volume+=0>a?.01*mvObject.volumeRate:-.01*mvObject.volumeRate);console.log("1 --------------\x3e ",mvObject.volume);b.volume=parseFloat(Math.min(Math.max(mvObject.volume,0),1).toFixed(2));console.log("2 --------------\x3e ",b.volume);console.log("2.1 --------------\x3e ",b.muted)}
function changePlaybackRate(a,b){setTimeout(function(c){a!==c&&(b.playbackRate=b.defaultPlaybackRate)},150,a);b.playbackRate+=0>a?.25:-.25;let d=parseFloat(Math.min(Math.max(b.playbackRate,.25),4).toFixed(2));displayIcon("play_speed",d,b);b.playbackRate=d}const getIncrement=(a,b)=>0>a?1*b:-1*b;
function seekVideoByAreas(a,b,d){let c=d.currentTime;a<=d.clientWidth/3?(a=mvObject.left,c+=getIncrement(b,mvObject.left)):a>d.clientWidth/3&&a<=d.clientWidth/3*2?(a=mvObject.middle,c+=getIncrement(b,mvObject.middle)):(a=mvObject.right,c+=getIncrement(b,mvObject.right));c=0>c?0:c;if(isNetflix)isNetflix&&document.dispatchEvent(new CustomEvent("mvNetflixSeek",{detail:1E3*parseInt(c)}));else{var e=Math.floor(c),f=e%60,g=Math.floor(e/60);e=Math.floor(e/3600);3600<=c?(g-=60*e,f=e+":"+(10>g?"0"+g:g)+":"+
(10>f?"0"+f:f)):f=(10>g?"0"+g:g)+":"+(10>f?"0"+f:f);a=0>b?"+"+a:"-"+a;0>b?displayIcon("seek_ff",`${f} (${a}) `,d):displayIcon("seek_rewind",`${f} (${a})`,d);d.currentTime=c}}
function close_popup(a){console.log("===============> CLOSING POP UP");document.mv_playing_on_popup=!1;document.mv_pause_function=!0;window.location!==window.parent.location?window.top.postMessage({mv_closePopup:!0,activatePopupTab:a},"*"):mvObject.popup("fechar",a);document.documentElement.style.overflow="revert";null!=document.mv_popup_element.defaultControls&&(document.mv_popup_element.controls=document.mv_popup_element.defaultControls);document.mv_popup_element.onclick=null;document.mv_popup_element.classList.remove("popup_style");
document.mv_placeholder.insertAdjacentElement("afterend",document.mv_popup_element);setTimeout(()=>{document.mv_pause_function=!1},500)}
function open_popup(a){console.log("IN OPEN POPUP");document.mv_playing_on_popup?(console.log("open_popup - going to clsoe it 1"),close_popup(!1)):document.mv_playing_on_popup||(document.mv_playing_on_popup=!0,document.mv_pause_function=!0,document.documentElement.style.overflow="hidden",document.mv_popup_element.className+=" popup_style",document.body.insertBefore(document.mv_popup_element,document.body.firstChild),document.mv_popup_element.defaultControls=document.mv_popup_element.controls,document.mv_popup_element.controls=
!0,document.mv_popup_element.onclick=()=>{document.mv_popup_element.paused?document.mv_popup_element.play():document.mv_popup_element.pause()},setTimeout(()=>{document.mv_pause_function=!1},500),window.location!==window.parent.location?(console.log("sending postMessage for ifram"),getTopIframe(window).postMessage({mv_topIframe:!0},"*")):(console.log("open_popup - Sending message to background script"),a||mvObject.popup("criar"),document.body.onfullscreenchange=null))}
function setBrightness(a,b){mvObject.brightness+=0>a?.1:-.1;mvObject.brightness=parseFloat(Math.min(Math.max(mvObject.brightness,0),1).toFixed(1));b.style.filter="brightness("+mvObject.brightness+")"}
async function controlPopoutEvent(a){console.log("1 @@@@@@@ start controlPopoutEvent");let {delta:b,vid:d,e:c}=a;"pip"==mvObject.popoutSetting&&(console.log("controlPopoutEvent - GOING IN POP UP"),activatePopupFeature(b,d,c));"fullscreen"==mvObject.popoutSetting&&(console.log("controlPopoutEvent - GOING IN FUUULSCREEn"),activateFullScreen());console.log("2 @@@@@@ end controlPopoutEvent")}function activateFullScreen(){open_popup(!0)}
function activatePopupFeature(a,b,d){0<a?document.mv_playing_on_popup?(console.log("open +1"),close_popup(!1)):document.fullscreenElement?(console.log("open +2"),document.exitFullscreen(),document.mv_pause_function=!0,setTimeout(()=>{document.mv_pause_function=!1},500)):(console.log("open +3"),open_popup()):0>a&&(console.log(" activatePopupFeature- !!!"),document.mv_playing_on_popup?(console.log("close -1"),close_popup(!1)):null==document.fullscreenElement&&function(c){setTimeout(function(){if(null==
document.fullscreenElement){console.log("close -2");const e=[...document.elementsFromPoint(d.x,d.y).filter(f=>f.contains(b)&&f.clientWidth===d.target.clientWidth||f.clientHeight===d.target.clientHeight).pop().querySelectorAll("*")].map(f=>[...f.attributes]).reduce((f,g)=>f.concat(g),[]).filter(f=>0<=f.nodeValue.toLowerCase().replace(" ","").indexOf("fullscreen")).filter(f=>f.ownerElement.clientWidth!==c.clientWidth&&f.ownerElement.clientHeight!==c.clientHeight);console.log("close -2.1",e);for(const f of e)try{null==
document.fullscreenElement&&f.ownerElement.click()}catch(g){}setTimeout(()=>{null==document.fullscreenElement&&c.requestFullscreen()},100)}},100)}(b))};
